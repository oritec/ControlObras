{% extends "base.html" %}
{% load staticfiles %}
{% load customtags %}
{% load tz %}
{% load sekizai_tags %}

{% block css %}
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="{% static 'common/css/jquery.nestable.css' %}" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL STYLES -->
{% endblock %}

{% block contenido %}
    {% if parque.no_aerogeneradores == 0 %}
        <div class="row">
            <div class="col-md-11 col-md-offset-1">
                <h4>Por favor, ingresar la informaci&oacute;n del parque (Configuraci&oacute;n).</h4>
            </div>
        </div>
    {%  else %}
        <div class="row">
            <div class="portlet box blue" style="margin-left:30px;margin-right:30px;">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-search"></i> Agregar DR
                    </div>
                </div>
                <div class="portlet-body form">
                    <!-- BEGIN FORM-->
                    {% include "dr/w_dr_form.html" %}
                </div>
            </div>
        </div>

        <div class = "row">
            <div class="portlet box grey-salsa" style="margin-left:30px;margin-right:30px;">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-search"></i> Actividades
                    </div>
                    <a href="#actividad" id="add_actividad" data-toggle="modal" class="btn btn-circle btn-xs yellow-saffron pull-right" style="margin-top: 10px;" >
                        <i class="fa fa-plus"></i>
                        Agregar
                    </a>
                </div>
                <div class="portlet-body">
                    {% if dr.actividaddr_set.count > 0 %}
                        <div class="dd" id="nestable">
                            <ol class="dd-list">
                                {% for actividad in dr.actividaddr_set.all %}
                                    <li class="dd-item" data-id="{{ forloop.counter }}" data-group="0">
                                        <div class="dd-handle-container">
                                            <div class="dd-handle" style="display: inline-block;">
                                                {{ actividad.descripcion }}
                                            </div>

                                            <a href="#composicion" id="add_composicion" act_id="{{ actividad.id }}" data-toggle="modal" class="btn btn-circle btn-xs yellow-saffron pull-right add_composicion" style="z-index: 999;display: inline-block;" >
                                                <i class="fa fa-plus"></i>
                                                Composici√≥n
                                            </a>
                                        </div>
                                        {% if actividad.composiciondr_set.count > 0 %}
                                            <ol class="dd-list">
                                                {% for composiciondr in actividad.composiciondr_set.all %}
                                                <li class="dd-item" data-id="{{ forloop.counter }}" data-group="1">
                                                    <div class="dd-handle-container">
                                                        <div class="dd-handle">{{ composiciondr.pie }} </div>
                                                    </div>
                                                </li>
                                                {% endfor %}
                                            </ol>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ol>
                        </div>

                    {% else %}
                        No se han agregado actividades.
                    {% endif %}
                </div>
            </div>

        </div>

        {% include 'dr/w_modal_actividad.html' %}
        {% include 'dr/w_modal_composicion.html' %}
    {% endif %}
{% endblock %}

{% block javascript %}
    <script src="{% static 'common/assets/global/plugins/jquery-nestable/jquery.nestable.js' %}" type="text/javascript"></script>
{% endblock %}

{% block jquery %}
    $('.dd').each(function(){
        $(this).nestable({
            maxDepth: 1,
            group: $(this).prop('id')
        });
    });
{% endblock %}